{% extends "layouts/base.html" %}
{% block title %}Vehículos - Rust-Eze{% endblock %}

{% block content %}
<div class="container fade-in-up">

    <section class="hero-shell">
        <span class="hero-chip">
            <i class="fa-solid fa-car"></i>
            Inventario
        </span>
        <h2 class="hero-title">
            Gestión de <span class="hero-gradient">Vehículos</span>
        </h2>
        <p class="hero-subtitle">
            Administra catálogo, imágenes, estados y precios del inventario.
        </p>
    </section>

    <div class="d-flex flex-column flex-md-row gap-2 justify-content-between align-items-md-center mb-3">
        <form class="d-flex gap-2" method="GET">
            <input type="text"
                   class="form-control form-control-sm"
                   name="q"
                   placeholder="Buscar marca, modelo, tipo..."
                   value="{{ request.args.get('q', '') }}">
            <select class="form-select form-select-sm" name="estado">
                {% set st = request.args.get('estado', '') %}
                <option value="" {{ 'selected' if st == '' else '' }}>Todos</option>
                <option value="Disponible" {{ 'selected' if st == 'Disponible' else '' }}>Disponible</option>
                <option value="Vendido" {{ 'selected' if st == 'Vendido' else '' }}>Vendido</option>
                <option value="Reservado" {{ 'selected' if st == 'Reservado' else '' }}>Reservado</option>
                <option value="Mantenimiento" {{ 'selected' if st == 'Mantenimiento' else '' }}>Mantenimiento</option>
            </select>
            <button class="btn btn-outline-light btn-sm" type="submit">
                <i class="fa-solid fa-filter me-1"></i> Filtrar
            </button>
        </form>

        <a href="{{ url_for('admin.vehiculos_new') }}"
           class="btn btn-primary btn-sm">
            <i class="fa-solid fa-circle-plus me-1"></i> Nuevo vehículo
        </a>
    </div>

    <div class="row g-3">
        {% for v in vehiculos %}
        <div class="col-md-6 col-lg-4">
            <div class="vehicle-card h-100 d-flex flex-column">
                <img src="{{ v.imagen_url or url_for('static', filename='images/vehicles/corolla.jpg') }}"
                     class="vehicle-img"
                     alt="{{ v.marca }} {{ v.modelo }}">
                <div class="p-3 d-flex flex-column flex-grow-1">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">{{ v.marca }} {{ v.modelo }}</h5>
                        <span class="badge-status">{{ v.anio }}</span>
                    </div>
                    <p class="text-muted mb-2" style="font-size:.85rem;">
                        {{ v.tipo }} • {{ v.color }}
                    </p>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="price-tag">{{ format_currency(v.precio) }}</span>
                        <span class="badge-status">
                            {{ v.estado_disponibilidad }}
                        </span>
                    </div>

                    <div class="d-flex gap-2 mt-auto">
                        <a class="btn btn-outline-light btn-sm w-50"
                           href="{{ url_for('admin.vehiculos_edit', vehiculo_id=v.vehiculo_id) }}">
                            <i class="fa-solid fa-pen-to-square me-1"></i> Editar
                        </a>

                        <form class="w-50"
                              method="POST"
                              action="{{ url_for('admin.vehiculos_delete', vehiculo_id=v.vehiculo_id) }}">
                            <button type="button"
                                    class="btn btn-outline-danger btn-sm w-100"
                                    onclick="confirmAction('¿Eliminar este vehículo? Esto puede fallar si tiene ventas asociadas.', () => this.closest('form').submit())">
                                <i class="fa-solid fa-trash me-1"></i> Eliminar
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12">
            <div class="card p-3 text-center">
                <span class="text-muted">No hay vehículos en el inventario.</span>
            </div>
        </div>
        {% endfor %}
    </div>

</div>
{% endblock %}
