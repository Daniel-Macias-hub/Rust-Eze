{% extends "layouts/client_base.html" %}

{% block title %}Mi Perfil - Cliente{% endblock %}

{% block client_content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Mi Perfil</h1>
</div>

<div class="row">
    <!-- Información Personal -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-user me-2"></i>Información Personal</h5>
            </div>
            <div class="card-body">
                {% if cliente %}
                <div class="row mb-3">
                    <div class="col-sm-4 fw-bold">Nombre:</div>
                    <div class="col-sm-8">{{ cliente.nombre_completo }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 fw-bold">Email:</div>
                    <div class="col-sm-8">{{ cliente.email }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 fw-bold">Teléfono:</div>
                    <div class="col-sm-8">{{ cliente.telefono or 'No especificado' }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 fw-bold">Dirección:</div>
                    <div class="col-sm-8">{{ cliente.direccion or 'No especificada' }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 fw-bold">Documento:</div>
                    <div class="col-sm-8">{{ cliente.tipo_documento }}: {{ cliente.numero_documento }}</div>
                </div>
                <div class="row">
                    <div class="col-sm-4 fw-bold">Miembro desde:</div>
                    <div class="col-sm-8">{{ cliente.fecha_registro[:10] }}</div>
                </div>
                {% else %}
                <p class="text-muted">No se pudo cargar la información del perfil.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Actualizar Información -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-edit me-2"></i>Actualizar Información</h5>
            </div>
            <div class="card-body">
                <form id="formActualizarPerfil">
                    <div class="mb-3">
                        <label class="form-label">Teléfono</label>
                        <input type="tel" class="form-control" name="telefono" 
                               value="{{ cliente.telefono or '' }}" 
                               placeholder="Ingrese su teléfono">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Dirección</label>
                        <textarea class="form-control" name="direccion" rows="3" 
                                  placeholder="Ingrese su dirección completa">{{ cliente.direccion or '' }}</textarea>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="actualizarPerfil()">
                        <i class="fas fa-save me-2"></i>Guardar Cambios
                    </button>
                </form>
            </div>
        </div>

        <!-- Información de la Cuenta -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-info-circle me-2"></i>Información de la Cuenta</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Estado de la cuenta
                        <span class="badge bg-success">Activa</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Tipo de usuario
                        <span class="badge bg-primary">Cliente</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Compras realizadas
                        <span class="badge bg-info">{{ compras|length if compras else 0 }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function actualizarPerfil() {
    const form = document.getElementById('formActualizarPerfil');
    const formData = new FormData(form);
    
    const data = {};
    for (let [key, value] of formData.entries()) {
        data[key] = value;
    }
    
    try {
        const result = await apiCall('/client/api/actualizar-perfil', data);
        
        if (result.success) {
            showNotification('✅ ' + result.message, 'success');
        } else {
            showNotification('❌ ' + result.message, 'error');
        }
    } catch (error) {
        showNotification('❌ Error al actualizar perfil', 'error');
    }
}
</script>
{% endblock %}